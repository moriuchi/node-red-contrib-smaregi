<script type="text/x-red" data-help-name="smaregi-transactions">
  <p>スマレジ・プラットフォームAPIを使用して、<code>Operation</code>で選択した以下の処理を実行します。</p>
  <ul>
    <li>取引一覧取得</li>
    <li>取引登録</li>
    <li>取引取得</li>
    <li>取引更新</li>
    <li>取引取消</li>
    <li>取引打消取消</li>
    <li>取引会員更新</li>
    <li>取引明細一覧CSV作成</li>
    <li>取引明細取得</li>
    <li>取置き一覧取得</li>
    <li>取置き登録</li>
    <li>取置き取得</li>
    <li>取置き打消取消</li>
    <li>仮販売一覧取得</li>
    <li>仮販売登録</li>
    <li>仮販売取得</li>
    <li>仮販売削除</li>
    <li>仮販売状態変更</li>
  </ul>

  <h3>入力</h3>
    <dl class="message-properties">
        <dt>ID <span class="property-type">文字列</span></dt>
        <dd>選択した処理を実行する取引IDまたは仮販売取引IDを入力します。</dd>
        <dt>Limit <span class="property-type">数値</span></dt>
        <dd>一覧取得時に一度に返すアイテム数を1 〜 1000の範囲で入力します。</dd>
        <dt>Page <span class="property-type">数値</span></dt>
        <dd>一覧取得時に取得する対象ページを入力します。</dd>
        <dt>取引日時 <span class="property-type">文字列</span></dt>
        <dd>取引明細一覧CSV作成する場合に取引日時(From)〜取引日時(To)を入力します。</dd>
        <dt>完了通知URL <span class="property-type">文字列</span></dt>
        <dd>取引明細CSVの作成処理が完了、もしくはエラーとなった際に、結果をWebhook通知するURLを入力します。</dd>
        <dt>取引区分 <span class="property-type">文字列</span></dt>
        <dd>仮販売状態変更する場合に仮販売のステータスを入力します。</dd>
        <dt>dataJson <span class="property-type">文字列 | オブジェクト</span></dt>
        <dd>選択した処理を実行するデータのJSONオブジェクトを入力します。</dd>
    </dl>

  <h3>出力</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">オブジェクト</span></dt>
        <dd>選択した処理の実行結果を出力します。</dd>
    </dl>

  <h3>詳細</h3>
  <h4>取引一覧取得</h4>
    <p>取引情報一覧を取得します。</p>
    <p><code>msg.limit</code>に一度に返すアイテム数を1 〜 1000の範囲で入力します。</p>
    <p><code>msg.page</code>に取得する対象ページを入力します。</p>
    <p>取得した取引情報一覧を出力します。</p>

  <h4>取引登録</h4>
    <p>取引を登録します。</p>
    <p><code>msg.dataJson</code>に登録する取引情報を入力します。必須項目をデフォルトでセットします。</p>
    <pre>{
    "transactionHeadDivision": "1",
    "subtotal": "1000",
    "total": "1000",
    "storeId": "1",
    "terminalId": "1",
    "terminalTranId": "1",
    "terminalTranDateTime": "2022-11-01T10:02:43+0900",
    "details": [{
        "transactionDetailId": "1",
        "transactionDetailDivision": "1",
        "salesPrice": "1000",
        "quantity": "1"
    }]
}</pre>
    <p>追加ボタンのクリックで選択した項目と入力した値をData JSONオブジェクトに追加します。</p>
    <p>取引明細1の追加ボタンのクリックで選択した項目と入力した値をData JSONオブジェクトdetailsの1件目に追加します。</p>
    <p>登録した取引情報を出力します。</p>

  <h4>取引取得</h4>
    <p>取引情報を取得します。</p>
    <p><code>msg.transactionId</code>に取得する取引IDを入力します。</p>
    <p>取得した取引情報を出力します。</p>

  <h4>取引更新</h4>
    <p>取引情報を更新します。</p>
    <p><code>msg.transactionId</code>に更新する取引IDを入力します。</p>
    <p><code>msg.dataJson</code>に更新する取引情報を入力します。</p>
    <pre>{"staffId":"1", "memo":"更新テスト"}</pre>
    <p>追加ボタンのクリックで選択した項目と入力した値をData JSONオブジェクトに追加します。</p>
    <p>更新した取引情報を出力します。</p>

  <h4>取引取消</h4>
    <p>取引を取消します。</p>
    <p><code>msg.transactionId</code>に取消をする取引IDを入力します。</p>
    <p>取消した取引情報を出力します。</p>

  <h4>取引打消取消</h4>
    <p>取引を打消取消します。指定された取引に対して、返品する取引情報を作成します。</p>
    <p><code>msg.transactionId</code>に打消取消をする取引IDを入力します。</p>
    <p>打消取消した取引情報を出力します。</p>

  <h4>取引会員更新</h4>
    <p>取引の会員情報を更新します。</p>
    <p><code>msg.transactionId</code>に会員情報を更新する取引IDを入力します。</p>
    <p><code>msg.dataJson</code>に更新する会員情報を入力します。</p>
    <pre>{"customerCode":"10001"}</pre>
    <p>追加ボタンのクリックで選択した項目と入力した値をData JSONオブジェクトに追加します。</p>
    <p>会員情報を更新した取引情報を出力します。</p>

  <h4>取引明細一覧CSV作成</h4>
    <p>取引明細情報一覧CSVファイルを作成します。</p>
    <p><code>msg.dateTimeFrom</code>に取得する取引明細の取引日時(From)を入力します。</p>
    <p><code>msg.dateTimeTo</code>に取得する取引明細の取引日時(To)を入力します。</p>
    <p><code>msg.callbackUrl</code>に取引明細CSVの作成処理結果をWebhook通知するURLを入力します。</p>
    <p>Webhook通知するURLやstate、問い合わせ用コードの情報を出力します。</p>

  <h4>取引明細取得</h4>
    <p>取引明細情報を取得します。</p>
    <p><code>msg.transactionId</code>に明細情報を取得する取引IDを入力します。</p>
    <p>取得した取引明細情報を出力します。</p>

  <h4>取置き一覧取得</h4>
    <p>取置き一覧を取得します。</p>
    <p><code>msg.limit</code>に一度に返すアイテム数を1 〜 1000の範囲で入力します。</p>
    <p><code>msg.page</code>に取得する対象ページを入力します。</p>
    <p>取得した取置き一覧を出力します。</p>

  <h4>取置き登録</h4>
    <p>取置き取引を登録します。</p>
    <p><code>msg.dataJson</code>に登録する取置き取引情報を入力します。必須項目をデフォルトでセットします。</p>
    <pre>{
    "transactionHeadDivision": "10",
    "subtotal": "1000",
    "total": "1000",
    "storeId": "1",
    "terminalId": "1",
    "terminalTranId": "1",
    "terminalTranDateTime": "2022-11-01T10:02:43+0900",
    "details": [{
      "transactionDetailId": "1",
      "transactionDetailDivision": "1",
      "salesPrice": "1000",
      "quantity": "1"
    }]
}</pre>
    <p>追加ボタンのクリックで選択した項目と入力した値をData JSONオブジェクトに追加します。</p>
    <p>取引明細1の追加ボタンのクリックで選択した項目と入力した値をData JSONオブジェクトdetailsの1件目に追加します。</p>
    <p>登録した取置き取引情報を出力します。</p>

  <h4>取置き取得</h4>
    <p>取置き情報を取得します。</p>
    <p><code>msg.transactionId</code>に取得する取引IDを入力します。</p>
    <p>取得した取置き情報を出力します。</p>

  <h4>取置き打消取消</h4>
    <p>取置きを打消取消します。指定された取置きに対して、返品する取置き情報を作成します。</p>
    <p><code>msg.transactionId</code>に打消取消する取引IDを入力します。</p>
    <p>打消取消した取置き情報を出力します。</p>

  <h4>仮販売一覧取得</h4>
    <p>仮販売取引情報一覧を取得します。</p>
    <p><code>msg.limit</code>に一度に返すアイテム数を1 〜 1000の範囲で入力します。</p>
    <p><code>msg.page</code>に取得する対象ページを入力します。</p>
    <p>取得した仮販売一覧を出力します。</p>

  <h4>仮販売登録</h4>
    <p>仮販売取引を登録します。</p>
    <p><code>msg.dataJson</code>に登録する仮販売取引情報を入力します。必須項目をデフォルトでセットします。</p>
    <pre>{
    "transactionHeadDivision": "1",
    "status": "0",
    "subtotal": "1000",
    "total": "1000",
    "storeId": "1",
    "terminalId": "1",
    "terminalTranId": "1",
    "terminalTranDateTime": "2022-11-01T10:02:43+0900",
    "details": [{
      "transactionDetailId": "1",
      "transactionDetailDivision": "1",
      "salesPrice": "1000",
      "quantity": "1"
    }]
}</pre>
    <p>追加ボタンのクリックで選択した項目と入力した値をData JSONオブジェクトに追加します。</p>
    <p>取引明細1の追加ボタンのクリックで選択した項目と入力した値をData JSONオブジェクトdetailsの1件目に追加します。</p>
    <p>登録した仮販売取引情報を出力します。</p>

  <h4>仮販売取得</h4>
    <p>仮販売取引情報を取得します。</p>
    <p><code>msg.transactionId</code>に取得する仮販売取引IDを入力します。</p>
    <p>取得した仮販売取引情報を出力します。</p>

  <h4>仮販売削除</h4>
    <p>指定された仮販売取引を削除します。</p>
    <p><code>msg.transactionId</code>に削除する仮販売取引IDを入力します。</p>
    <p>削除した仮販売取引情報(empty)を出力します。</p>

  <h4>仮販売状態変更</h4>
    <p>仮販売取引の状態を変更します。</p>
    <p><code>msg.transactionId</code>に状態を変更する仮販売取引IDを入力します。</p>
    <p><code>msg.temporaryStatus</code>に変更する仮販売のステータスを選択します。</p>
    <p>状態を変更した仮販売取引情報を出力します。</p>

  <p></p>
  <p><b>注</b>: 入力項目はノードの編集ダイアログでも入力可能ですが、<code>msg.xx</code>で渡された値が優先されます。</p>

<h3>参照</h3>
  <p>詳細は、<a href="https://www1.smaregi.dev/apidoc/#tag/%E5%8F%96%E5%BC%95">スマレジ・プラットフォームAPI POS仕様書</a>の取引の各項を参照してください。</p>

</script>